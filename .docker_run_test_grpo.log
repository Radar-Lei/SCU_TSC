============================================================
GRPO数据生成器测试
============================================================

=== 测试配置 ===
默认决策秒数: 5
默认并行数: 19
场景目录: /home/samuel/SCU_TSC/sumo_simulation/environments
输出目录: /home/samuel/SCU_TSC/data/grpo_datasets
✓ 配置加载正确

=== 测试时间戳生成 ===
仿真时间 0s: 2025-01-01 00:00:00
仿真时间 3661s: 2025-01-01 01:01:01
✓ 时间戳生成正确

=== 测试Prompt构建器 ===
生成的Prompt:
{
  "crossing_id": 1234,
  "as_of": "2025-01-01 08:30:00",
  "phase_order": [
    0,
    2,
    4,
    6
  ],
  "state": {
    "current_phase_id": 2,
    "phase_metrics_by_id": {
      "0": {
        "avg_queue_veh": 3.5
      },
      "2": {
        "avg_queue_veh": 1.2
      },
      "4": {
        "avg_queue_veh": 5.8
      },
      "6": {
        "avg_queue_veh": 0.0
      }
    }
  }
}
✓ Prompt格式正确

=== 测试单场景数据生成 ===
正在生成场景 arterial4x4_1 的数据...
（这可能需要几分钟，取决于场景长度）
[arterial4x4_1] 开始生成GRPO数据集...
[arterial4x4_1] 配置文件: /home/samuel/SCU_TSC/sumo_simulation/environments/arterial4x4_1/arterial4x4.sumocfg
[arterial4x4_1] 输出目录: /tmp/tmpxom6m_fq/arterial4x4_1
 Retrying in 1 seconds
[arterial4x4_1] 信号灯: ['nt1', 'nt10', 'nt11', 'nt12', 'nt13', 'nt14', 'nt15', 'nt16', 'nt2', 'nt3', 'nt4', 'nt5', 'nt6', 'nt7', 'nt8', 'nt9']
[arterial4x4_1] nt1 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt10 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt11 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt12 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt13 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt14 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt15 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt16 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt2 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt3 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt4 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt5 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt6 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt7 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt8 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] nt9 有效相位: [0, 2, 4, 5, 6, 8]
[arterial4x4_1] 步数: 1000, 时间: 1100s, 数据: 531条
[arterial4x4_1] 步数: 2000, 时间: 2100s, 数据: 1068条
[arterial4x4_1] 步数: 3000, 时间: 3100s, 数据: 1611条
[arterial4x4_1] 步数: 4000, 时间: 4100s, 数据: 2148条
[arterial4x4_1] 步数: 5000, 时间: 5100s, 数据: 2687条
[arterial4x4_1] 步数: 6000, 时间: 6100s, 数据: 3226条
[arterial4x4_1] 步数: 7000, 时间: 7100s, 数据: 3763条
[arterial4x4_1] 步数: 8000, 时间: 8100s, 数据: 4306条
[arterial4x4_1] 步数: 9000, 时间: 9100s, 数据: 4843条
[arterial4x4_1] 步数: 10000, 时间: 10100s, 数据: 5382条
[arterial4x4_1] 仿真结束
数据集已保存: /tmp/tmpxom6m_fq/arterial4x4_1/grpo_dataset.json
[arterial4x4_1] 生成完成，共 5863 条数据
✓ 生成了 5863 条数据

第一条数据示例:
  ID: arterial4x4_1_nt12_101_1
  仿真时间: 101.0s
  当前相位: 4
  绿灯已持续: 101.0s
  可以延长: False
  状态文件: states/state_nt12_101_1.xml
✓ 数据集文件已保存: /tmp/tmpxom6m_fq/arterial4x4_1/grpo_dataset.json

============================================================
测试完成
============================================================
